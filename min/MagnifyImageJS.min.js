/*! 
    MagnifyImageJS    Copyright (C) 2020 AonaSuzutsuki.
    MIT License
*/

function MagnifyImageJS(t,e,i){const h=t,n=e,o=i;let l=0,d=0,a={widthRatio:1,heightRatio:1},g={widthRatio:1,heightRatio:1},c=0,s=0,r=!1;const m=(t,e,i)=>{let a=document.getElementById(h),g=document.getElementById(n),m=document.getElementById(o);if(!r)return;let R=((t,e,i,h,n)=>{let o=t.x*e.widthRatio-l,a=t.y*e.heightRatio-d,g=t.x-l*i.widthRatio,r=t.y-d*i.heightRatio;return o<0&&(o=0,g=0),a<0&&(a=0,r=0),o+h.clientWidth>=c&&(o=c-h.clientWidth,g=n.clientWidth-h.clientWidth*i.widthRatio),a+h.clientHeight>=s&&(a=s-h.clientHeight,r=n.clientHeight-h.clientHeight*i.heightRatio),{x:o,y:a,lensX:g,lensY:r}})((t=>{let e=document.getElementById(h);t=t||window.event;let i=e.getBoundingClientRect(),n=t.pageX-i.left,o=t.pageY-i.top;return{x:n-=window.pageXOffset,y:o-=window.pageYOffset}})(t),e,i,g,a);w=R,m=m,g.style.backgroundPosition=`top ${-w.y}px left ${-w.x}px`,m.style.left=`${w.lensX}px`,m.style.top=`${w.lensY}px`};var w,R;const y=(t,e)=>{let i={},h={};return i.widthRatio=t.width/e.clientWidth,i.heightRatio=t.height/e.clientHeight,h.widthRatio=e.clientWidth/t.width,h.heightRatio=e.clientHeight/t.height,{toRatio:i,fromRatio:h}};this.refreshHoverImage=(t=>{m(t,a,g)}),this.calculateRatios=(()=>{let t=document.getElementById(h),e=y({width:c,height:s},t);a=e.toRatio,g=e.fromRatio}),this.setHoverImage=(async()=>{let t=document.getElementById(h),e=document.getElementById(n),i=t.src;t.dataset.orig&&(i=t.dataset.orig);let m=await(t=>new Promise((e,i)=>{const h=new Image;h.onload=(()=>e(h)),h.onerror=(t=>i(t)),h.src=t}))(i);if(c=m.width,s=m.height,!(r=(t=>c>t.width&&s>t.height)(t)))return;l=e.clientWidth/2,d=e.clientHeight/2;let w=y(m,t);a=w.toRatio,g=w.fromRatio,e.style.backgroundImage="url('"+i+"')",e.style.backgroundSize=`${m.width}px ${m.height}px`;let R=document.getElementById(o);R.style.width=`${e.clientWidth*g.widthRatio}px`,R.style.height=`${e.clientHeight*g.heightRatio}px`}),this.canZoom=(()=>r)}
